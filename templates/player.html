<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Poker Player</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: #f5f5f5;
      background: radial-gradient(circle at top, #004f3a 0, #00110f 60%);
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .join-box {
      text-align: center;
      margin-top: 10px;
    }
    .join-box input {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #444;
    }
    .join-box button {
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      background: #1c7c3d;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin-left: 4px;
    }
    .join-box button:hover {
      background: #249c4c;
    }

    .table-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .table {
      position: relative;
      width: 650px;
      height: 330px;
      background: #005533;
      border-radius: 50%;
      border: 8px solid #c27b37;
      box-shadow: 0 0 40px rgba(0,0,0,0.7);
    }
    .board-area {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .board-cards {
      display: flex;
      gap: 4px;
    }
    .card {
      width: 42px;
      height: 58px;
      border-radius: 6px;
      border: 1px solid #111;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 15px;
      color: #111;
    }
    .card.back {
      background: #245c40;
      color: #245c40;
    }
    .info-line {
      font-size: 13px;
    }

    .my-info {
      max-width: 650px;
      margin: 20px auto;
      background: #00000080;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
      font-size: 13px;
    }
    .buttons {
      margin-top: 8px;
    }
    .buttons button {
      margin-right: 6px;
      padding: 5px 10px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #1c7c3d;
      color: #fff;
      font-weight: bold;
      font-size: 12px;
    }
    .buttons button:hover {
      background: #249c4c;
    }
    .buttons input {
      width: 60px;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #444;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>Poker Table â€“ Player</h1>

  <div class="join-box">
    <input id="name-input" placeholder="Your name" />
    <button id="join-btn">Join Table</button>
    <span id="join-status"></span>
  </div>

  <div class="table-wrapper">
    <div class="table">
      <div class="board-area">
        <div class="board-cards" id="board-cards">
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
        </div>
        <div class="info-line">
          Pot: <span id="pot-value">0</span> |
          Street: <span id="street-label">-</span>
        </div>
      </div>
    </div>
  </div>

  <div class="my-info" id="my-info" style="display:none;">
    <div><strong>Seat:</strong> <span id="my-seat">-</span></div>
    <div><strong>Your cards:</strong> <span id="my-cards">-</span></div>
    <div><strong>To call:</strong> <span id="to-call-span">0</span></div>
    <div class="buttons">
      <button id="fold-btn">Fold</button>
      <button id="check-btn">Check</button>
      <button id="call-btn">Call</button>
      <input id="raise-amount" type="number" min="0" value="20" />
      <button id="raise-btn">Raise</button>
    </div>
  </div>

<script>
  const socket = io();

  let mySeat = null;
  let lastToCall = 0;

  const nameInput = document.getElementById("name-input");
  const joinBtn = document.getElementById("join-btn");
  const joinStatus = document.getElementById("join-status");

  const potSpan = document.getElementById("pot-value");
  const streetSpan = document.getElementById("street-label");
  const boardDiv = document.getElementById("board-cards");

  const myInfoBox = document.getElementById("my-info");
  const mySeatSpan = document.getElementById("my-seat");
  const myCardsSpan = document.getElementById("my-cards");
  const toCallSpan = document.getElementById("to-call-span");

  const foldBtn = document.getElementById("fold-btn");
  const checkBtn = document.getElementById("check-btn");
  const callBtn = document.getElementById("call-btn");
  const raiseBtn = document.getElementById("raise-btn");
  const raiseAmountInput = document.getElementById("raise-amount");

  joinBtn.addEventListener("click", () => {
    socket.emit("join_table", { name: nameInput.value.trim() || "Guest" });
  });

  socket.on("join_result", (res) => {
    if (!res.success) {
      joinStatus.textContent = "Failed: " + res.error;
    } else {
      mySeat = res.seat;
      mySeatSpan.textContent = mySeat;
      joinStatus.textContent = "Joined as seat " + mySeat;
      myInfoBox.style.display = "block";
    }
  });

  socket.on("hole_cards", (data) => {
    const cards = data.cards || [];
    myCardsSpan.textContent = cards.length ? cards.join(" ") : "-";
  });

  socket.on("request_action", (data) => {
    if (data.seat !== mySeat) return;
    lastToCall = data.to_call || 0;
    toCallSpan.textContent = lastToCall;
  });

  socket.on("table_state", (data) => {
    potSpan.textContent = data.pot || 0;
    streetSpan.textContent = data.street || "-";

    const board = data.board || [];
    boardDiv.innerHTML = "";
    for (let i = 0; i < 5; i++) {
      const card = document.createElement("div");
      card.className = "card";
      if (i < board.length) {
        card.textContent = board[i];
      } else {
        card.classList.add("back");
        card.textContent = "?";
      }
      boardDiv.appendChild(card);
    }

    // Clear to-call if no one is asked
    if (data.current_player_seat !== mySeat) {
      toCallSpan.textContent = "0";
    }
  });

  socket.on("table_reset", () => {
    myCardsSpan.textContent = "-";
    toCallSpan.textContent = "0";
    potSpan.textContent = "0";
    streetSpan.textContent = "-";
    boardDiv.innerHTML = "";
    for (let i = 0; i < 5; i++) {
      const card = document.createElement("div");
      card.className = "card back";
      card.textContent = "?";
      boardDiv.appendChild(card);
    }
  });

  function sendAction(action, extraAmount) {
    if (mySeat === null) return;
    const amount = extraAmount || 0;
    socket.emit("player_action", {
      seat: mySeat,
      action: action,
      amount: amount,
    });
  }

  foldBtn.addEventListener("click", () => sendAction("FOLD", 0));
  checkBtn.addEventListener("click", () => sendAction("CHECK", 0));
  callBtn.addEventListener("click", () => sendAction("CALL", 0));
  raiseBtn.addEventListener("click", () => {
    const amt = parseInt(raiseAmountInput.value || "0", 10);
    sendAction("RAISE", amt);
  });
</script>
</body>
</html>
