<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Console – Poker Table</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #101318;
      color: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      width: 900px;
      background: #171a21;
      border-radius: 10px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      padding: 16px 18px 18px;
      display: grid;
      grid-template-columns: 2.1fr 1.3fr;
      grid-gap: 14px;
    }

    .section {
      background: #1d2129;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ea4b3;
    }

    .section-header span {
      font-weight: 500;
    }

    h1 {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .btn {
      border: none;
      outline: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
      background: #2b3240;
      color: #f5f5f5;
      transition: background 0.15s, transform 0.05s;
      margin-right: 6px;
    }

    .btn:last-child {
      margin-right: 0;
    }

    .btn:hover {
      background: #394154;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-primary {
      background: #2563eb;
    }

    .btn-primary:hover {
      background: #1e4fba;
    }

    .btn-small {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn.disabled,
    .btn:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .field-row {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      gap: 6px;
    }

    label {
      font-size: 12px;
      color: #9ea4b3;
    }

    input[type="text"],
    input[type="number"] {
      background: #11141b;
      border-radius: 6px;
      border: 1px solid #2b3240;
      padding: 5px 7px;
      font-size: 12px;
      color: #f5f5f5;
      outline: none;
      min-width: 0;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      border-color: #2563eb;
    }

    .table-board {
      text-align: center;
      padding: 8px 6px 10px;
      border-radius: 8px;
      background: radial-gradient(circle at center, #234c34 0, #15251b 55%, #101318 100%);
      margin-bottom: 6px;
    }

    .board-row {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-top: 4px;
    }

    .card {
      width: 40px;
      height: 56px;
      border-radius: 6px;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      color: #11141b;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }

    .card-rank {
      font-size: 16px;
      margin-bottom: -2px;
    }

    .card-suit {
      font-size: 14px;
    }

    .card.empty {
      background: rgba(0, 0, 0, 0.2);
      color: #666f80;
      box-shadow: none;
    }

    .board-meta {
      margin-top: 6px;
      font-size: 12px;
      color: #cbd0dd;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .pill {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 999px;
      padding: 2px 9px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-gap: 6px;
      margin-top: 4px;
    }

    .player-card {
      background: #141822;
      border-radius: 6px;
      padding: 6px 7px;
      font-size: 11px;
      border: 1px solid transparent;
      position: relative;
    }

    .player-card.me {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.45);
    }

    .player-card.hero {
      border-color: #2563eb;
    }

    .player-card .name-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1px;
    }

    .player-card .name {
      font-weight: 500;
      font-size: 11px;
    }

    .player-card .seat {
      font-size: 10px;
      color: #9ea4b3;
    }

    .player-card .chips-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-top: 1px;
    }

    .tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 1px 5px;
      border: 1px solid #3b4251;
      color: #e5e7eb;
    }

    .tag-folded {
      border-color: #7f1d1d;
      color: #fecaca;
      background: rgba(127, 29, 29, 0.35);
    }

    .tag-acting {
      border-color: #facc15;
      color: #fef9c3;
      background: rgba(234, 179, 8, 0.23);
    }

    .hero-panel {
      margin-top: 4px;
      border-top: 1px solid #262c3a;
      padding-top: 6px;
    }

    .hero-cards-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hero-cards-row .label {
      font-size: 12px;
      color: #9ea4b3;
      min-width: 60px;
    }

    .hero-cards-row .card {
      width: 44px;
      height: 60px;
    }

    .info-line {
      font-size: 11px;
      color: #cbd0dd;
      margin-top: 4px;
    }

    .info-line strong {
      color: #e5e7eb;
    }

    .player-actions {
      margin-top: 6px;
      border-top: 1px solid #262c3a;
      padding-top: 6px;
    }

    .player-actions-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 4px;
    }

    .stats-table th,
    .stats-table td {
      padding: 3px 4px;
      text-align: left;
    }

    .stats-table th {
      color: #9ea4b3;
      font-weight: 500;
      border-bottom: 1px solid #262c3a;
    }

    .stats-table tr:nth-child(even) td {
      background: #151927;
    }

    .stats-table tr:nth-child(odd) td {
      background: #0f131d;
    }

    .log-box {
      font-size: 11px;
      background: #0f131b;
      border-radius: 6px;
      border: 1px solid #262c3a;
      padding: 6px;
      max-height: 260px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.35;
    }

    .log-line {
      margin-bottom: 2px;
      color: #9ea4b3;
    }

    .log-line strong {
      color: #e5e7eb;
    }

  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT COLUMN: TABLE + PLAYER -->
    <div>
      <div class="section">
        <div class="top-bar">
          <div>
            <h1>Player Console</h1>
            <div style="font-size:11px;color:#9ea4b3;">Join as a seat (1–6) and act when requested.</div>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <input id="name-input" type="text" placeholder="Your name" style="width:130px;">
            <button class="btn btn-primary btn-small" id="btn-join">Join Table</button>
          </div>
        </div>
        <div class="info-line" id="info-seat">
          Not yet seated. Enter a name and click "Join Table".
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <span>Table</span>
          <span id="label-seat-status">Seat: -</span>
        </div>

        <div class="table-board">
          <div class="board-row" id="board-cards"></div>
          <div class="board-meta">
            <div class="pill" id="label-street">Street: -</div>
            <div class="pill" id="label-pot">Pot: 0</div>
          </div>
        </div>

        <div class="players-grid" id="players-grid"></div>

        <div class="hero-panel">
          <div class="hero-cards-row">
            <div class="label">Your cards:</div>
            <div id="my-cards-display">
              No cards yet.
            </div>
          </div>
          <div class="info-line" id="info-current-player">
            Waiting for table state…
          </div>
        </div>

        <div class="player-actions">
          <div class="section-header" style="margin-bottom:4px;">
            <span>Your Action</span>
            <span id="label-to-call">To call: -</span>
          </div>
          <div class="player-actions-row">
            <button class="btn btn-small btn-danger" id="btn-fold" disabled>Fold</button>
            <button class="btn btn-small" id="btn-check-call" disabled>Check / Call</button>
            <div style="display:flex;align-items:center;gap:4px;">
              <button class="btn btn-small btn-primary" id="btn-raise" disabled>Raise</button>
              <input type="number" id="raise-amount" placeholder="Amt" min="1" style="width:70px;">
            </div>
            <div style="font-size:11px;color:#9ea4b3;">
              Buttons are enabled only when it is your turn.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: STATS + LOG -->
    <div>
      <div class="section">
        <div class="section-header">
          <span>Player Stats</span>
          <span>VPIP / PFR</span>
        </div>
        <table class="stats-table" id="stats-table">
          <thead>
            <tr>
              <th>Seat</th>
              <th>Name</th>
              <th>Hands</th>
              <th>VPIP%</th>
              <th>PFR%</th>
            </tr>
          </thead>
          <tbody>
          <!-- stats rows -->
          </tbody>
        </table>
      </div>

      <div class="section">
        <div class="section-header">
          <span>Event Log</span>
        </div>
        <div class="log-box" id="log-box"></div>
      </div>
    </div>
  </div>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
          integrity="sha384-vtKq+W3r5pIDxVf8Xfqs21WX5Kqbn8LPfqf7H+G+uKSRbH0L4/8SmhV9hE2Yxw+k"
          crossorigin="anonymous"></script>
  <script>
    const socket = io();

    const nameInput = document.getElementById('name-input');
    const btnJoin = document.getElementById('btn-join');

    const boardCardsDiv = document.getElementById('board-cards');
    const playersGrid = document.getElementById('players-grid');
    const myCardsDisplay = document.getElementById('my-cards-display');
    const labelStreet = document.getElementById('label-street');
    const labelPot = document.getElementById('label-pot');
    const labelSeatStatus = document.getElementById('label-seat-status');
    const labelToCall = document.getElementById('label-to-call');
    const infoSeat = document.getElementById('info-seat');
    const infoCurrentPlayer = document.getElementById('info-current-player');

    const btnFold = document.getElementById('btn-fold');
    const btnCheckCall = document.getElementById('btn-check-call');
    const btnRaise = document.getElementById('btn-raise');
    const raiseAmountInput = document.getElementById('raise-amount');

    const statsTableBody = document.querySelector('#stats-table tbody');
    const logBox = document.getElementById('log-box');

    let mySeat = null;
    let lastToCall = 0;
    let isMyTurn = false;

    // --- Utility: card rendering ---

    function renderCard(code) {
      if (!code || code.length < 2) {
        const div = document.createElement('div');
        div.className = 'card empty';
        return div;
      }
      const rank = code[0];
      const suitChar = code[1];
      let suitSymbol = '?';
      let color = '#11141b';
      if (suitChar === 'h') { suitSymbol = '♥'; color = '#b91c1c'; }
      else if (suitChar === 'd') { suitSymbol = '♦'; color = '#b91c1c'; }
      else if (suitChar === 'c') { suitSymbol = '♣'; color = '#11141b'; }
      else if (suitChar === 's') { suitSymbol = '♠'; color = '#11141b'; }

      const div = document.createElement('div');
      div.className = 'card';
      const rankSpan = document.createElement('div');
      rankSpan.className = 'card-rank';
      rankSpan.textContent = rank;
      const suitSpan = document.createElement('div');
      suitSpan.className = 'card-suit';
      suitSpan.textContent = suitSymbol;
      suitSpan.style.color = color;
      div.appendChild(rankSpan);
      div.appendChild(suitSpan);
      return div;
    }

    function appendLog(text) {
      const line = document.createElement('div');
      line.className = 'log-line';
      line.innerHTML = text;
      logBox.appendChild(line);
      logBox.scrollTop = logBox.scrollHeight;
    }

    function setActionButtonsEnabled(enabled) {
      btnFold.disabled = !enabled;
      btnCheckCall.disabled = !enabled;
      btnRaise.disabled = !enabled;
    }

    // --- Socket.IO events ---

    socket.on('connect', () => {
      appendLog('<strong>Connected</strong> to server.');
    });

    socket.on('join_result', (data) => {
      if (!data.success) {
        appendLog('<strong>Join failed:</strong> ' + (data.error || 'Unknown error'));
        return;
      }
      mySeat = data.seat;
      labelSeatStatus.textContent = 'Seat: ' + mySeat;
      infoSeat.innerHTML = 'You are seated at <strong>Seat ' + mySeat + '</strong>. Wait for your hole cards.';
      btnJoin.disabled = true;
      nameInput.disabled = true;
      appendLog('Joined table as <strong>Seat ' + mySeat + '</strong>.');
    });

    // Hole cards sent privately from server to this player
    socket.on('hole_cards', (data) => {
      const cards = (data && data.cards) || [];
      myCardsDisplay.innerHTML = '';
      if (cards.length === 0) {
        myCardsDisplay.textContent = 'No cards yet.';
        return;
      }
      cards.forEach(c => {
        myCardsDisplay.appendChild(renderCard(c));
      });
      appendLog('Your hole cards: <strong>' + cards.join(' ') + '</strong>');
    });

    socket.on('table_state', (data) => {
      if (!data) return;

      const street = data.street || '-';
      const pot = data.pot || 0;
      labelStreet.textContent = 'Street: ' + street;
      labelPot.textContent = 'Pot: ' + pot;

      // Board
      boardCardsDiv.innerHTML = '';
      const board = data.board || [];
      for (let i = 0; i < 5; i++) {
        boardCardsDiv.appendChild(renderCard(board[i]));
      }

      // Players
      playersGrid.innerHTML = '';
      const players = data.players || [];
      const currentSeat = data.current_player_seat;
      players.forEach(p => {
        const card = document.createElement('div');
        card.className = 'player-card';
        if (p.seat === mySeat) card.classList.add('me');
        if (p.is_hero) card.classList.add('hero');

        const nameRow = document.createElement('div');
        nameRow.className = 'name-row';
        const nameDiv = document.createElement('div');
        nameDiv.className = 'name';
        nameDiv.textContent = p.name + (p.is_hero ? ' (Hero)' : '');
        const seatDiv = document.createElement('div');
        seatDiv.className = 'seat';
        seatDiv.textContent = 'Seat ' + p.seat;
        nameRow.appendChild(nameDiv);
        nameRow.appendChild(seatDiv);

        const chipsRow = document.createElement('div');
        chipsRow.className = 'chips-row';
        const chipsDiv = document.createElement('div');
        chipsDiv.textContent = 'Chips: ' + p.chips;
        const tagsDiv = document.createElement('div');

        if (p.folded) {
          const tag = document.createElement('span');
          tag.className = 'tag tag-folded';
          tag.textContent = 'Folded';
          tagsDiv.appendChild(tag);
        } else if (p.seat === currentSeat) {
          const tag = document.createElement('span');
          tag.className = 'tag tag-acting';
          tag.textContent = 'To act';
          tagsDiv.appendChild(tag);
        }

        chipsRow.appendChild(chipsDiv);
        chipsRow.appendChild(tagsDiv);

        card.appendChild(nameRow);
        card.appendChild(chipsRow);
        playersGrid.appendChild(card);
      });

      // Info current player
      if (currentSeat === null || currentSeat === undefined) {
        infoCurrentPlayer.textContent = 'No active player to act.';
      } else {
        let who = 'Seat ' + currentSeat;
        if (currentSeat === 0) {
          who = 'Hero (Seat 0)';
        }
        infoCurrentPlayer.textContent = 'Current player to act: ' + who;
      }

      // If it is no longer my turn, disable buttons
      if (currentSeat !== mySeat) {
        isMyTurn = false;
        setActionButtonsEnabled(false);
        labelToCall.textContent = 'To call: -';
      }
    });

    // Server asks this player to act
    socket.on('request_action', (data) => {
      if (!data) return;
      const seat = data.seat;
      const toCall = data.to_call || 0;
      if (mySeat === null || seat !== mySeat) {
        return; // not for us
      }
      isMyTurn = true;
      lastToCall = toCall;
      labelToCall.textContent = 'To call: ' + toCall;
      setActionButtonsEnabled(true);

      if (toCall === 0) {
        appendLog('It is your turn. <strong>You may CHECK or RAISE.</strong>');
      } else {
        appendLog('It is your turn. <strong>To call: ' + toCall + '</strong>. You may FOLD, CALL, or RAISE.');
      }
    });

    socket.on('hand_result', (data) => {
      appendLog('<strong>Hand finished</strong>. Board: ' + (data.board || []).join(' '));
      isMyTurn = false;
      setActionButtonsEnabled(false);
      labelToCall.textContent = 'To call: -';
    });

    socket.on('stats_update', (data) => {
      const stats = (data && data.stats) || [];
      statsTableBody.innerHTML = '';
      stats.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.seat}</td>
          <td>${s.name}</td>
          <td>${s.hands_played}</td>
          <td>${s.vpip_pct}</td>
          <td>${s.pfr_pct}</td>
        `;
        statsTableBody.appendChild(tr);
      });
    });

    socket.on('table_reset', () => {
      appendLog('<strong>Table reset</strong>.');
      boardCardsDiv.innerHTML = '';
      playersGrid.innerHTML = '';
      myCardsDisplay.innerHTML = 'No cards yet.';
      labelStreet.textContent = 'Street: -';
      labelPot.textContent = 'Pot: 0';
      infoCurrentPlayer.textContent = 'Table reset. Wait for new hand.';
      labelToCall.textContent = 'To call: -';
      setActionButtonsEnabled(false);
    });

    // --- Button handlers ---

    btnJoin.addEventListener('click', () => {
      const name = nameInput.value.trim() || 'Guest';
      socket.emit('join_table', { name: name });
    });

    btnFold.addEventListener('click', () => {
      if (!isMyTurn || mySeat === null) return;
      socket.emit('player_action', {
        seat: mySeat,
        action: 'FOLD',
        amount: 0,
      });
      appendLog('You chose: <strong>FOLD</strong>.');
      setActionButtonsEnabled(false);
      isMyTurn = false;
    });

    btnCheckCall.addEventListener('click', () => {
      if (!isMyTurn || mySeat === null) return;
      let action = 'CALL';
      if (lastToCall === 0) {
        action = 'CHECK';
      }
      socket.emit('player_action', {
        seat: mySeat,
        action: action,
        amount: 0,
      });
      appendLog('You chose: <strong>' + action + '</strong>.');
      setActionButtonsEnabled(false);
      isMyTurn = false;
    });

    btnRaise.addEventListener('click', () => {
      if (!isMyTurn || mySeat === null) return;
      let amt = parseInt(raiseAmountInput.value || '0', 10);
      if (!amt || amt <= 0) {
        // basic default if nothing specified
        amt = 20;
      }
      socket.emit('player_action', {
        seat: mySeat,
        action: 'RAISE',
        amount: amt,
      });
      appendLog('You chose: <strong>RAISE to ' + amt + '</strong>.');
      setActionButtonsEnabled(false);
      isMyTurn = false;
    });

    // Initial state
    setActionButtonsEnabled(false);
  </script>
</body>
</html>
