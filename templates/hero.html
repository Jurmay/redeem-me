<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hero Console – Poker AI</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #101318;
      color: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      width: 1100px;
      background: #171a21;
      border-radius: 10px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
      padding: 16px 18px 20px;
      display: grid;
      grid-template-columns: 2fr 1.4fr;
      grid-gap: 14px;
    }

    .section {
      background: #1d2129;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 8px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ea4b3;
    }

    .section-header span {
      font-weight: 500;
    }

    h1 {
      font-size: 18px;
      margin-bottom: 6px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .btn {
      border: none;
      outline: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
      background: #2b3240;
      color: #f5f5f5;
      transition: background 0.15s, transform 0.05s;
      margin-right: 6px;
    }

    .btn:last-child {
      margin-right: 0;
    }

    .btn:hover {
      background: #394154;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-primary {
      background: #2563eb;
    }

    .btn-primary:hover {
      background: #1e4fba;
    }

    .btn-danger {
      background: #b91c1c;
    }

    .btn-danger:hover {
      background: #991b1b;
    }

    .btn-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
    }

    .btn-small {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #3b4251;
    }

    .btn.disabled,
    .btn:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .field-row {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      gap: 6px;
    }

    label {
      font-size: 12px;
      color: #9ea4b3;
    }

    input[type="text"],
    input[type="number"] {
      background: #11141b;
      border-radius: 6px;
      border: 1px solid #2b3240;
      padding: 5px 7px;
      font-size: 12px;
      color: #f5f5f5;
      outline: none;
      min-width: 0;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      border-color: #2563eb;
    }

    .table-board {
      text-align: center;
      padding: 8px 6px 10px;
      border-radius: 8px;
      background: radial-gradient(circle at center, #234c34 0, #15251b 55%, #101318 100%);
      margin-bottom: 6px;
    }

    .board-row {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-top: 4px;
    }

    .card {
      width: 40px;
      height: 56px;
      border-radius: 6px;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      color: #11141b;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }

    .card-rank {
      font-size: 16px;
      margin-bottom: -2px;
    }

    .card-suit {
      font-size: 14px;
    }

    .card.empty {
      background: rgba(0, 0, 0, 0.2);
      color: #666f80;
      box-shadow: none;
    }

    .board-meta {
      margin-top: 6px;
      font-size: 12px;
      color: #cbd0dd;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .pill {
      background: rgba(15, 23, 42, 0.7);
      border-radius: 999px;
      padding: 2px 9px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-gap: 6px;
      margin-top: 4px;
    }

    .player-card {
      background: #141822;
      border-radius: 6px;
      padding: 6px 7px;
      font-size: 11px;
      border: 1px solid transparent;
      position: relative;
    }

    .player-card.hero {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
    }

    .player-card .name-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1px;
    }

    .player-card .name {
      font-weight: 500;
      font-size: 11px;
    }

    .player-card .seat {
      font-size: 10px;
      color: #9ea4b3;
    }

    .player-card .chips-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      margin-top: 1px;
    }

    .tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 1px 5px;
      border: 1px solid #3b4251;
      color: #e5e7eb;
    }

    .tag-folded {
      border-color: #7f1d1d;
      color: #fecaca;
      background: rgba(127, 29, 29, 0.35);
    }

    .tag-acting {
      border-color: #facc15;
      color: #fef9c3;
      background: rgba(234, 179, 8, 0.23);
    }

    .hero-panel {
      margin-top: 4px;
      border-top: 1px solid #262c3a;
      padding-top: 6px;
    }

    .hero-cards-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hero-cards-row .label {
      font-size: 12px;
      color: #9ea4b3;
      min-width: 50px;
    }

    .hero-cards-row .card {
      width: 44px;
      height: 60px;
    }

    .info-line {
      font-size: 11px;
      color: #cbd0dd;
      margin-top: 4px;
    }

    .info-line strong {
      color: #e5e7eb;
    }

    .suggestion-box {
      font-size: 12px;
      background: #11141b;
      border-radius: 6px;
      border: 1px solid #323949;
      padding: 6px 7px;
      margin-top: 4px;
      min-height: 42px;
    }

    .suggestion-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .suggestion-action {
      font-weight: 600;
      font-size: 13px;
    }

    .suggestion-mode-pill {
      font-size: 10px;
      padding: 1px 7px;
      border-radius: 999px;
      border: 1px solid #3b4251;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .suggestion-reason {
      font-size: 11px;
      color: #9ea4b3;
    }

    .hero-actions {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    .hero-actions .btn {
      min-width: 70px;
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
      margin-top: 4px;
    }

    .stats-table th,
    .stats-table td {
      padding: 3px 4px;
      text-align: left;
    }

    .stats-table th {
      color: #9ea4b3;
      font-weight: 500;
      border-bottom: 1px solid #262c3a;
    }

    .stats-table tr:nth-child(even) td {
      background: #151927;
    }

    .stats-table tr:nth-child(odd) td {
      background: #0f131d;
    }

    .log-box {
      font-size: 11px;
      background: #0f131b;
      border-radius: 6px;
      border: 1px solid #262c3a;
      padding: 6px;
      max-height: 220px;
      overflow-y: auto;
      white-space: pre-wrap;
      line-height: 1.35;
    }

    .log-line {
      margin-bottom: 2px;
      color: #9ea4b3;
    }

    .log-line strong {
      color: #e5e7eb;
    }

  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT COLUMN: TABLE + HERO -->
    <div>
      <div class="section">
        <div class="top-bar">
          <div>
            <h1>Hero Console</h1>
            <div style="font-size: 11px; color:#9ea4b3;">Seat 0 • Hero AI with Auto/Manual Toggle</div>
          </div>
          <div>
            <button class="btn btn-pill btn-outline" id="btn-auto">Auto</button>
            <button class="btn btn-pill btn-outline" id="btn-manual">Manual</button>
          </div>
        </div>

        <div class="section" style="margin-top:6px;">
          <div class="section-header">
            <span>Hand Control</span>
          </div>
          <div class="field-row">
            <label for="hero-cards-input">Hero cards</label>
            <input id="hero-cards-input" type="text" placeholder="e.g. As Kd (optional)">
          </div>
          <div class="field-row">
            <label for="board-cards-input">Board cards</label>
            <input id="board-cards-input" type="text" placeholder="e.g. Ah Kc 7d 2s 3c (optional)">
          </div>
          <div style="margin-top:4px;">
            <button class="btn btn-primary btn-small" id="btn-start">Start Hand</button>
            <button class="btn btn-small" id="btn-reset">Reset Table</button>
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <span>Table</span>
            <span id="label-hero-mode">Mode: Auto</span>
          </div>

          <div class="table-board">
            <div class="board-row" id="board-cards"></div>
            <div class="board-meta">
              <div class="pill" id="label-street">Street: -</div>
              <div class="pill" id="label-pot">Pot: 0</div>
            </div>
          </div>

          <div class="players-grid" id="players-grid"></div>

          <div class="hero-panel">
            <div class="hero-cards-row">
              <div class="label">Hero:</div>
              <div id="hero-cards-display">
                <!-- hero cards rendered here -->
              </div>
            </div>
            <div class="info-line" id="info-current-player">
              Waiting for game state…
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">
            <span>AI Suggestion & Hero Action</span>
          </div>

          <div class="suggestion-box">
            <div class="suggestion-main">
              <div class="suggestion-action" id="suggestion-action">No suggestion yet.</div>
              <div class="suggestion-mode-pill" id="suggestion-mode-pill">AUTO</div>
            </div>
            <div class="suggestion-reason" id="suggestion-reason">
              When it's Hero's turn, the AI suggestion will appear here.
            </div>
          </div>

          <div class="hero-actions">
            <button class="btn btn-small btn-danger" id="btn-fold" disabled>Fold</button>
            <button class="btn btn-small" id="btn-check-call" disabled>Check / Call</button>
            <div style="display:flex;align-items:center;gap:4px;">
              <button class="btn btn-small btn-primary" id="btn-raise" disabled>Raise</button>
              <input type="number" id="raise-amount" placeholder="Amt" min="1" style="width:70px;">
            </div>
            <div style="font-size:11px;color:#9ea4b3;">
              Manual mode: choose your action. Auto mode: buttons disabled.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT COLUMN: STATS + LOG -->
    <div>
      <div class="section">
        <div class="section-header">
          <span>Player Stats</span>
          <span>VPIP / PFR</span>
        </div>
        <table class="stats-table" id="stats-table">
          <thead>
            <tr>
              <th>Seat</th>
              <th>Name</th>
              <th>Hands</th>
              <th>VPIP%</th>
              <th>PFR%</th>
            </tr>
          </thead>
          <tbody>
          <!-- stats rows -->
          </tbody>
        </table>
      </div>

      <div class="section">
        <div class="section-header">
          <span>Event Log</span>
        </div>
        <div class="log-box" id="log-box"></div>
      </div>
    </div>
  </div>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
          integrity="sha384-vtKq+W3r5pIDxVf8Xfqs21WX5Kqbn8LPfqf7H+G+uKSRbH0L4/8SmhV9hE2Yxw+k"
          crossorigin="anonymous"></script>
  <script>
    const socket = io();

    const btnStart = document.getElementById('btn-start');
    const btnReset = document.getElementById('btn-reset');
    const btnAuto = document.getElementById('btn-auto');
    const btnManual = document.getElementById('btn-manual');

    const heroCardsInput = document.getElementById('hero-cards-input');
    const boardCardsInput = document.getElementById('board-cards-input');

    const boardCardsDiv = document.getElementById('board-cards');
    const playersGrid = document.getElementById('players-grid');
    const heroCardsDisplay = document.getElementById('hero-cards-display');
    const labelStreet = document.getElementById('label-street');
    const labelPot = document.getElementById('label-pot');
    const labelHeroMode = document.getElementById('label-hero-mode');
    const infoCurrentPlayer = document.getElementById('info-current-player');

    const suggestionAction = document.getElementById('suggestion-action');
    const suggestionReason = document.getElementById('suggestion-reason');
    const suggestionModePill = document.getElementById('suggestion-mode-pill');

    const btnFold = document.getElementById('btn-fold');
    const btnCheckCall = document.getElementById('btn-check-call');
    const btnRaise = document.getElementById('btn-raise');
    const raiseAmountInput = document.getElementById('raise-amount');

    const statsTableBody = document.querySelector('#stats-table tbody');
    const logBox = document.getElementById('log-box');

    let currentHeroMode = 'auto';      // "auto" | "manual"
    let lastHeroSuggestion = null;     // { action, amount, reason, mode }

    // --- Utility: card rendering ---

    function renderCard(code) {
      if (!code || code.length < 2) {
        const div = document.createElement('div');
        div.className = 'card empty';
        div.textContent = '';
        return div;
      }
      const rank = code[0];
      const suitChar = code[1];
      let suitSymbol = '?';
      let color = '#11141b';
      if (suitChar === 'h') { suitSymbol = '♥'; color = '#b91c1c'; }
      else if (suitChar === 'd') { suitSymbol = '♦'; color = '#b91c1c'; }
      else if (suitChar === 'c') { suitSymbol = '♣'; color = '#11141b'; }
      else if (suitChar === 's') { suitSymbol = '♠'; color = '#11141b'; }

      const div = document.createElement('div');
      div.className = 'card';
      const rankSpan = document.createElement('div');
      rankSpan.className = 'card-rank';
      rankSpan.textContent = rank;
      const suitSpan = document.createElement('div');
      suitSpan.className = 'card-suit';
      suitSpan.textContent = suitSymbol;
      suitSpan.style.color = color;
      div.appendChild(rankSpan);
      div.appendChild(suitSpan);
      return div;
    }

    function appendLog(text) {
      const line = document.createElement('div');
      line.className = 'log-line';
      line.innerHTML = text;
      logBox.appendChild(line);
      logBox.scrollTop = logBox.scrollHeight;
    }

    function setHeroModeUI(mode) {
      currentHeroMode = mode;
      labelHeroMode.textContent = 'Mode: ' + (mode === 'auto' ? 'Auto' : 'Manual');
      suggestionModePill.textContent = mode.toUpperCase();

      // Toggle button styles
      if (mode === 'auto') {
        btnAuto.classList.add('btn-primary');
        btnManual.classList.remove('btn-primary');
      } else {
        btnManual.classList.add('btn-primary');
        btnAuto.classList.remove('btn-primary');
      }

      // Enable/disable manual action buttons
      const disabled = (mode === 'auto');
      btnFold.disabled = disabled;
      btnCheckCall.disabled = disabled;
      btnRaise.disabled = disabled;
    }

    // --- Socket.IO events ---

    socket.on('connect', () => {
      appendLog('<strong>Connected</strong> to server.');
      socket.emit('hero_join', {});
    });

    socket.on('hero_joined', (data) => {
      appendLog('Hero joined the table.');
      if (data && data.mode) {
        setHeroModeUI(data.mode);
      } else {
        setHeroModeUI('auto');
      }
    });

    socket.on('hero_mode', (data) => {
      if (!data || !data.mode) return;
      setHeroModeUI(data.mode);
      appendLog('Hero mode set to <strong>' + data.mode.toUpperCase() + '</strong>.');
    });

    socket.on('table_state', (data) => {
      if (!data) return;

      // Street & pot
      const street = data.street || '-';
      const pot = data.pot || 0;
      labelStreet.textContent = 'Street: ' + street;
      labelPot.textContent = 'Pot: ' + pot;

      // Board
      boardCardsDiv.innerHTML = '';
      const board = data.board || [];
      for (let i = 0; i < 5; i++) {
        const cardCode = board[i];
        boardCardsDiv.appendChild(renderCard(cardCode));
      }

      // Players
      playersGrid.innerHTML = '';
      const players = data.players || [];
      const currentSeat = data.current_player_seat;
      players.forEach(p => {
        const card = document.createElement('div');
        card.className = 'player-card';
        if (p.is_hero) card.classList.add('hero');

        const nameRow = document.createElement('div');
        nameRow.className = 'name-row';
        const nameDiv = document.createElement('div');
        nameDiv.className = 'name';
        nameDiv.textContent = p.name + (p.is_hero ? ' (Hero)' : '');
        const seatDiv = document.createElement('div');
        seatDiv.className = 'seat';
        seatDiv.textContent = 'Seat ' + p.seat;
        nameRow.appendChild(nameDiv);
        nameRow.appendChild(seatDiv);

        const chipsRow = document.createElement('div');
        chipsRow.className = 'chips-row';
        const chipsDiv = document.createElement('div');
        chipsDiv.textContent = 'Chips: ' + p.chips;
        const tagsDiv = document.createElement('div');

        if (p.folded) {
          const tag = document.createElement('span');
          tag.className = 'tag tag-folded';
          tag.textContent = 'Folded';
          tagsDiv.appendChild(tag);
        } else if (p.seat === currentSeat) {
          const tag = document.createElement('span');
          tag.className = 'tag tag-acting';
          tag.textContent = 'To act';
          tagsDiv.appendChild(tag);
        }

        chipsRow.appendChild(chipsDiv);
        chipsRow.appendChild(tagsDiv);

        card.appendChild(nameRow);
        card.appendChild(chipsRow);
        playersGrid.appendChild(card);
      });

      // Info current player
      if (currentSeat === null || currentSeat === undefined) {
        infoCurrentPlayer.textContent = 'No active player to act.';
      } else {
        let who = 'Seat ' + currentSeat;
        const hero = players.find(p => p.seat === 0);
        if (hero && currentSeat === hero.seat) {
          who = 'Hero (Seat 0)';
        }
        infoCurrentPlayer.textContent = 'Current player to act: ' + who;
      }

      // Mode from table state if present
      if (data.hero_mode) {
        setHeroModeUI(data.hero_mode);
      }
    });

    socket.on('hero_hole_cards', (data) => {
      const cards = (data && data.cards) || [];
      heroCardsDisplay.innerHTML = '';
      if (cards.length === 0) {
        heroCardsDisplay.textContent = 'No cards yet.';
        return;
      }
      cards.forEach(c => {
        heroCardsDisplay.appendChild(renderCard(c));
      });
      appendLog('Hero hole cards: <strong>' + cards.join(' ') + '</strong>');
    });

    socket.on('hero_decision', (data) => {
      if (!data) return;
      lastHeroSuggestion = data;
      const act = data.action || '-';
      const amt = data.amount || 0;
      const reason = data.reason || '';
      const mode = data.mode || currentHeroMode;

      suggestionAction.textContent = act + (act === 'RAISE' && amt ? ' to ' + amt : '');
      suggestionReason.textContent = reason || 'AI suggested: ' + act;
      suggestionModePill.textContent = mode.toUpperCase();

      // If mode from server, sync UI
      setHeroModeUI(mode);

      appendLog('AI suggests: <strong>' + act + (act === 'RAISE' && amt ? ' to ' + amt : '') + '</strong>.');
    });

    socket.on('hand_result', (data) => {
      appendLog('<strong>Hand finished</strong>. Board: ' + (data.board || []).join(' '));
    });

    socket.on('stats_update', (data) => {
      const stats = (data && data.stats) || [];
      statsTableBody.innerHTML = '';
      stats.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.seat}</td>
          <td>${s.name}</td>
          <td>${s.hands_played}</td>
          <td>${s.vpip_pct}</td>
          <td>${s.pfr_pct}</td>
        `;
        statsTableBody.appendChild(tr);
      });
    });

    socket.on('table_reset', () => {
      appendLog('<strong>Table reset</strong>.');
      boardCardsDiv.innerHTML = '';
      playersGrid.innerHTML = '';
      heroCardsDisplay.innerHTML = '';
      labelStreet.textContent = 'Street: -';
      labelPot.textContent = 'Pot: 0';
      infoCurrentPlayer.textContent = 'Table reset. Start a new hand.';
      suggestionAction.textContent = 'No suggestion yet.';
      suggestionReason.textContent = 'When it\'s Hero\'s turn, the AI suggestion will appear here.';
      lastHeroSuggestion = null;
    });

    // --- Button handlers ---

    btnStart.addEventListener('click', () => {
      const heroCards = heroCardsInput.value.trim();
      const boardCards = boardCardsInput.value.trim();
      socket.emit('hero_start_hand', {
        hero_cards: heroCards || null,
        board_cards: boardCards || null,
      });
      appendLog('Requested <strong>new hand</strong>.');
    });

    btnReset.addEventListener('click', () => {
      socket.emit('hero_reset');
    });

    btnAuto.addEventListener('click', () => {
      socket.emit('hero_set_mode', { mode: 'auto' });
    });

    btnManual.addEventListener('click', () => {
      socket.emit('hero_set_mode', { mode: 'manual' });
    });

    btnFold.addEventListener('click', () => {
      if (currentHeroMode !== 'manual') return;
      socket.emit('hero_action', { action: 'FOLD', amount: 0 });
      appendLog('Hero manually chose: <strong>FOLD</strong>.');
    });

    btnCheckCall.addEventListener('click', () => {
      if (currentHeroMode !== 'manual') return;
      // Server will interpret CALL or CHECK correctly depending on state;
      // we send "CALL" but you can also choose "CHECK" if you prefer.
      socket.emit('hero_action', { action: 'CALL', amount: 0 });
      appendLog('Hero manually chose: <strong>CALL/CHECK</strong>.');
    });

    btnRaise.addEventListener('click', () => {
      if (currentHeroMode !== 'manual') return;
      let amt = parseInt(raiseAmountInput.value || '0', 10);
      if (!amt || amt <= 0) {
        // If no amount input, fall back to suggested amount if available
        if (lastHeroSuggestion && lastHeroSuggestion.amount) {
          amt = lastHeroSuggestion.amount;
        } else {
          amt = 20; // default
        }
      }
      socket.emit('hero_action', { action: 'RAISE', amount: amt });
      appendLog('Hero manually chose: <strong>RAISE to ' + amt + '</strong>.');
    });

    // Initial UI state
    setHeroModeUI('auto');
  </script>
</body>
</html>
