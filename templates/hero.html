<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Poker Hero (AI Coach)</title>
 <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: #f5f5f5;
      background: radial-gradient(circle at top, #004f3a 0, #00110f 60%);
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .top-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 15px auto;
      padding: 8px;
    }
    .top-controls input {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #444;
      width: 170px;
    }
    .top-controls button {
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #1c7c3d;
      color: #fff;
      font-weight: bold;
    }
    .top-controls button:hover {
      background: #249c4c;
    }

    .table-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .table {
      position: relative;
      width: 700px;
      height: 360px;
      background: #005533;
      border-radius: 50%;
      border: 8px solid #c27b37;
      box-shadow: 0 0 40px rgba(0,0,0,0.7);
    }
    .seat {
      position: absolute;
      width: 140px;
      height: 55px;
      background: #00000088;
      border-radius: 10px;
      padding: 4px 8px;
      font-size: 12px;
      box-shadow: 0 0 8px #000;
    }
    .seat.active {
      border: 2px solid #ffd54f;
    }
    .seat-name {
      font-weight: bold;
    }
    .seat-chips {
      font-size: 11px;
      opacity: 0.9;
    }
    .seat-note {
      font-size: 11px;
      opacity: 0.75;
    }

    /* seat positions around oval */
    .seat-hero   { top: -25px; left: 280px; }
    .seat-1      { top: 80px;  left: 40px;  }
    .seat-2      { top: 80px;  right: 40px; }
    .seat-3      { bottom: 80px; left: 40px; }
    .seat-4      { bottom: 80px; right: 40px; }
    .seat-5      { bottom: -25px; left: 180px; }
    .seat-6      { bottom: -25px; right: 180px; }

    .board-area {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .board-cards {
      display: flex;
      gap: 4px;
    }
    .card {
      width: 46px;
      height: 62px;
      border-radius: 6px;
      border: 1px solid #111;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      color: #111;
    }
    .card.back {
      background: #245c40;
      color: #245c40;
    }
    .info-line {
      font-size: 13px;
    }

    .panels {
      display: flex;
      gap: 16px;
      margin: 20px auto;
      max-width: 1100px;
    }
    .panel {
      flex: 1;
      background: #00000080;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
      font-size: 13px;
    }
    .panel h3 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 14px;
      border-bottom: 1px solid #444;
      padding-bottom: 3px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #444;
      padding: 3px 4px;
      text-align: center;
    }
    th {
      background: #123322;
    }
  </style>
</head>
<body>
  <h1>Texas Hold’em – Hero / AI Coach</h1>

  <div class="top-controls">
    <input id="hero-cards-input" placeholder="Hero cards (e.g. As Kd)" />

    <input id="flop-input" placeholder="Flop (e.g. Ah Kc 7d)" />
    <input id="turn-input" placeholder="Turn (e.g. 2s)" />
    <input id="river-input" placeholder="River (e.g. 3c)" />

    <button id="start-hand-btn">Start Hand</button>
    <button id="reset-btn">Reset</button>
    <button id="download-btn">Download CSV</button>
  </div>

  <div class="table-wrapper">
    <div class="table">
      <div class="seat seat-hero" id="seat-0">
        <div class="seat-name">Hero AI</div>
        <div class="seat-chips">Chips: -</div>
        <div class="seat-note"></div>
      </div>
      <div class="seat seat-1" id="seat-1"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>
      <div class="seat seat-2" id="seat-2"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>
      <div class="seat seat-3" id="seat-3"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>
      <div class="seat seat-4" id="seat-4"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>
      <div class="seat seat-5" id="seat-5"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>
      <div class="seat seat-6" id="seat-6"><div class="seat-name">Empty</div><div class="seat-chips">-</div><div class="seat-note"></div></div>

      <div class="board-area">
        <div class="board-cards" id="board-cards">
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
          <div class="card back">?</div>
        </div>
        <div class="info-line">
          Pot: <span id="pot-value">0</span> |
          Street: <span id="street-label">-</span>
        </div>
      </div>
    </div>
  </div>

  <div class="panels">
    <div class="panel">
      <h3>Hero Hand</h3>
      <div id="hero-hand-display">—</div>
    </div>
    <div class="panel">
      <h3>AI Decision</h3>
      <div>Action: <span id="ai-action">—</span></div>
      <div>Amount: <span id="ai-amount">—</span></div>
      <div>Reason:</div>
      <div id="ai-reason">—</div>
    </div>
    <div class="panel">
      <h3>Last Hand Result</h3>
      <div id="last-result-box">—</div>
    </div>
  </div>

  <div class="panels">
    <div class="panel">
      <h3>Player Stats</h3>
      <table id="stats-table">
        <thead>
          <tr>
            <th>Seat</th>
            <th>Name</th>
            <th>Hands</th>
            <th>VPIP %</th>
            <th>PFR %</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
  const socket = io();

  const heroCardsInput = document.getElementById("hero-cards-input");
  const flopInput = document.getElementById("flop-input");
  const turnInput = document.getElementById("turn-input");
  const riverInput = document.getElementById("river-input");

  const startBtn = document.getElementById("start-hand-btn");
  const resetBtn = document.getElementById("reset-btn");
  const downloadBtn = document.getElementById("download-btn");

  const potSpan = document.getElementById("pot-value");
  const streetSpan = document.getElementById("street-label");
  const boardDiv = document.getElementById("board-cards");

  const heroHandDiv = document.getElementById("hero-hand-display");
  const aiActionSpan = document.getElementById("ai-action");
  const aiAmountSpan = document.getElementById("ai-amount");
  const aiReasonDiv = document.getElementById("ai-reason");
  const lastResultBox = document.getElementById("last-result-box");

  const statsTableBody = document.querySelector("#stats-table tbody");

  // Tell server we are the hero console
  socket.emit("hero_join", {});

  // Start hand: combine flop/turn/river into single board string
  startBtn.addEventListener("click", () => {
    const heroCardsStr = heroCardsInput.value.trim();
    const flopStr = flopInput.value.trim();
    const turnStr = turnInput.value.trim();
    const riverStr = riverInput.value.trim();

    const board = [];
    if (flopStr) board.push(...flopStr.split(/\s+/));
    if (turnStr) board.push(turnStr);
    if (riverStr) board.push(riverStr);
    const boardStr = board.length ? board.join(" ") : null;

    socket.emit("hero_start_hand", {
      hero_cards: heroCardsStr || null,
      board_cards: boardStr,
    });
  });

  resetBtn.addEventListener("click", () => {
    socket.emit("hero_reset");
  });

  downloadBtn.addEventListener("click", () => {
    window.location.href = "/history.csv";
  });

  socket.on("table_state", (data) => {
    potSpan.textContent = data.pot || 0;
    streetSpan.textContent = data.street || "-";

    // Board
    const board = data.board || [];
    boardDiv.innerHTML = "";
    for (let i = 0; i < 5; i++) {
      const card = document.createElement("div");
      card.className = "card";
      if (i < board.length) {
        card.textContent = board[i];
      } else {
        card.classList.add("back");
        card.textContent = "?";
      }
      boardDiv.appendChild(card);
    }

    // Seats
    for (let s = 0; s <= 6; s++) {
      const seatDiv = document.getElementById("seat-" + s);
      if (!seatDiv) continue;
      seatDiv.classList.remove("active");
      seatDiv.querySelector(".seat-name").textContent = "Empty";
      seatDiv.querySelector(".seat-chips").textContent = "-";
      seatDiv.querySelector(".seat-note").textContent = "";
    }

    (data.players || []).forEach((p) => {
      const seatDiv = document.getElementById("seat-" + p.seat);
      if (!seatDiv) return;
      seatDiv.querySelector(".seat-name").textContent = p.name;
      seatDiv.querySelector(".seat-chips").textContent = "Chips: " + p.chips;
      if (p.folded) {
        seatDiv.querySelector(".seat-note").textContent = "Folded";
      } else if (data.current_player_seat === p.seat) {
        seatDiv.querySelector(".seat-note").textContent = "To act";
        seatDiv.classList.add("active");
      } else {
        seatDiv.querySelector(".seat-note").textContent = "";
      }
    });
  });

  socket.on("hero_hole_cards", (data) => {
    const cards = data.cards || [];
    if (!cards.length) {
      heroHandDiv.textContent = "—";
    } else {
      heroHandDiv.textContent = cards.join(" ");
    }
  });

  socket.on("hero_decision", (decision) => {
    aiActionSpan.textContent = decision.action || "—";
    aiAmountSpan.textContent = decision.amount || 0;
    aiReasonDiv.textContent = decision.reason || "—";
  });

  socket.on("hand_result", (result) => {
    const boardStr = (result.board || []).join(" ");
    let html = `<p><strong>Board:</strong> ${boardStr}</p>`;
    html += `<p><strong>Note:</strong> ${result.note || ""}</p>`;
    html += "<ul>";
    (result.players || []).forEach((p) => {
      const cards = (p.hole_cards || []).join(" ");
      const folded = p.folded ? " (folded)" : "";
      html += `<li>Seat ${p.seat} – ${p.name}: ${cards}${folded}</li>`;
    });
    html += "</ul>";
    lastResultBox.innerHTML = html;
  });

  socket.on("stats_update", (data) => {
    const stats = data.stats || [];
    statsTableBody.innerHTML = "";
    stats.forEach((row) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.seat}</td>
        <td>${row.name}</td>
        <td>${row.hands_played}</td>
        <td>${row.vpip_pct}</td>
        <td>${row.pfr_pct}</td>
      `;
      statsTableBody.appendChild(tr);
    });
  });

  socket.on("table_reset", () => {
    heroCardsInput.value = "";
    flopInput.value = "";
    turnInput.value = "";
    riverInput.value = "";

    potSpan.textContent = "0";
    streetSpan.textContent = "-";
    boardDiv.innerHTML = "";
    for (let i = 0; i < 5; i++) {
      const card = document.createElement("div");
      card.className = "card back";
      card.textContent = "?";
      boardDiv.appendChild(card);
    }
    heroHandDiv.textContent = "—";
    aiActionSpan.textContent = "—";
    aiAmountSpan.textContent = "—";
    aiReasonDiv.textContent = "—";
    lastResultBox.textContent = "—";
    statsTableBody.innerHTML = "";

    for (let s = 0; s <= 6; s++) {
      const seatDiv = document.getElementById("seat-" + s);
      if (!seatDiv) continue;
      seatDiv.classList.remove("active");
      seatDiv.querySelector(".seat-name").textContent = (s === 0) ? "Hero AI" : "Empty";
      seatDiv.querySelector(".seat-chips").textContent = "-";
      seatDiv.querySelector(".seat-note").textContent = "";
    }
  });
</script>
</body>
</html>
